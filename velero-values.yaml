image:
  repository: velero/velero
  tag: v1.17.1 # Match chart version 11.3.2

# Skip CRD upgrade job (causes ImagePullBackOff)
upgradeCRDs: false
cleanUpCRDs: false

initContainers:
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.10.1
    volumeMounts:
      - mountPath: /target
        name: plugins

configuration:
  # NFS storage via S3 API (MinIO running on NFS)
  backupStorageLocation:
    - name: default
      provider: aws
      bucket: velero
      config:
        region: minio
        s3ForcePathStyle: "true"
        s3Url: http://minio.velero.svc.cluster.local:9000
        publicUrl: http://minio.velero.svc.cluster.local:9000

  volumeSnapshotLocation:
    - name: default
      provider: aws
      config:
        region: minio

  # Use kopia for filesystem-level PVC backups (restic was deprecated)
  uploaderType: kopia
  defaultVolumesToFsBackup: true

  # Namespaces to include in cluster backups
  backupSyncPeriod: 1h
  restoreOnlyMode: false

  # Increase timeout for large volumes
  fsBackupTimeout: 4h

# Disable node agent to reduce resource usage
# Can be enabled later when cluster has more resources
deployNodeAgent: false

credentials:
  useSecret: true
  existingSecret: velero-credentials

# Schedules (defined separately as CRDs)
schedules: {}

resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

rbac:
  create: true

serviceAccount:
  server:
    create: true
